<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecodom</title>
    <meta name="description" content="EcoDom - —Å–∏—Å—Ç–µ–º–∞ —É–º–Ω–æ–≥–æ –¥–æ–º–∞ –Ω–∞ Raspberry Pi.">
    <script src="/chart.js"></script>
    <!-- <script src="/jsmpeg.min.js"></script> -->
    <meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f5f5f7" media="(prefers-color-scheme: light)">
    <link rel="stylesheet" href="index.css">
    <script src="/hls.js"></script>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
   <div id="demoWarning" data-key="demo.warning" style="display: none;">
        –í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–µ–º–æ-—Ä–µ–∂–∏–º. –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –≤–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    </div>    
    <header>
        <div class="header-inner">
            <h1 data-key="app.name">EcoDom</h1>
            <div class="header-controls">
                <div class="language-switcher">
                    <button class="lang-btn" data-lang="ru">RU</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="kz">KZ</button>
                </div>
                <button id="themeToggle" class="icon-btn" aria-label="Theme">üåì</button>
                <button id="logoutBtn" class="icon-btn" aria-label="Logout">üö™</button>
            </div>
        </div>
    </header>
    
    <nav>
        <div class="nav-inner">
            <button class="tab-btn active" data-tab="dashboard" data-key="tab.dashboard">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab-btn" data-tab="history" data-key="tab.history">–ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="tab-btn" data-tab="settings" data-key="tab.settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </nav>

    <main>
        <div id="sensor-error" class="error-message" style="display: none;"></div>
        <div class="container">
            
            <!-- DASHBOARD -->
            <div id="dashboard" class="tab-content active">
                <h2 data-key="dashboard.title">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</h2>
                <div class="sensors-grid">
                    <div class="sensor-card">
                        <h3 data-key="temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</h3>    
                        <p id="temp-value">--</p>
                        <p>¬∞C</p>
                    </div>
                    <div class="sensor-card">
                        <h3 data-key="humidity">–í–ª–∞–∂–Ω–æ—Å—Ç—å</h3>
                        <p id="humidity-value">--</p>
                        <p>%</p>
                    </div>
                    <div class="sensor-card">
                        <h3 data-key="co">CO (ppm)</h3>
                        <p id="co-value">--</p>
                    </div>
                    <div class="sensor-card">
                        <h3 data-key="solar">–°–æ–ª–Ω–µ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏</h3>
                        <p id="solar-value">--</p>
                        <p>–í—Ç</p>
                    </div>
                    <div class="sensor-card">
                        <h3 data-key="wind">–í–µ—Ç—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä</h3>
                        <p id="wind-value">--</p>
                        <p>–í</p>
                    </div>
                    <div class="sensor-card">
                        <h3 data-key="motion">–î–≤–∏–∂–µ–Ω–∏–µ</h3>
                        <p id="motion-value">--</p>
                    </div>
                    <div class="sensor-card">
                        <h3 data-key="battery">–ë–∞—Ç–∞—Ä–µ—è</h3>
                        <p id="battery-value">--</p>
                        <span id="battery-icon" class="battery-icon"></span>
                        <p>%</p>
                    </div>
                </div>

                <!-- <div class="device-section">
                    <div style="margin-top: 20px;">
                        <h4>–°–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä:</h4>
                        <div id="ipCamList" class="overlay-list">
                            // –°–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS
                        </div>
                    </div>
                    
                </div> -->

                <div class="device-section">
                    <div class="section-header">
                        <h2 data-key="cameras.title">–ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
                        <!-- <button id="refreshDevicesBtn" class="refresh-btn">üîÑ</button> -->
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
                    <div class="device-stats-bar">
                        <span class="stat-badge total">–í—Å–µ–≥–æ: <b id="totalDevices">0</b></span>
                        <span class="stat-badge online">–û–Ω–ª–∞–π–Ω: <b id="onlineDevices">0</b></span>
                        <span class="stat-badge offline">–û—Ñ–ª–∞–π–Ω: <b id="offlineDevices">0</b></span>
                    </div>

                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–∞–º–µ—Ä -->
                    <div id="camerasContainer" class="devices-grid">
                        <div class="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤...</div>
                    </div>
                </div>
                
                <div class="main-controls">
                    <!-- <h2 data-key="lighting.title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ–º</h2>
                    <div class="control-grid" id="lightingControls"></div> -->
                
                    <h2 data-key="scenarios.title">–°—Ü–µ–Ω–∞—Ä–∏–∏</h2>
                    <div class="scenario-control">
                        <label class="switch">
                            <input type="checkbox" id="awayScenario">
                            <span class="slider"></span>
                        </label>
                        <span data-key="scenario.away">–†–µ–∂–∏–º "–£—Ö–æ–¥"</span>
                    </div>
                </div>
            </div>
            
            <!-- HISTORY -->
            <div id="history" class="tab-content">
                <h2 data-key="history.title">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π</h2>
                <div class="history-controls">
                    <select id="historySensor">
                        <option value="temp" data-key="temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</option>
                        <option value="humidity" data-key="humidity">–í–ª–∞–∂–Ω–æ—Å—Ç—å</option>
                        <option value="co_ppm" data-key="co">CO (ppm)</option>
                        <option value="solar_voltage" data-key="solar">–°–æ–ª–Ω–µ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏</option>
                        <option value="wind_voltage" data-key="wind">–í–µ—Ç—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä</option>
                        <option value="battery_level" data-key="battery">–ë–∞—Ç–∞—Ä–µ—è</option>
                        <option value="motion" data-key="motion">–î–≤–∏–∂–µ–Ω–∏–µ</option>
                    </select>
                    <select id="historyRange">
                        <option value="1" data-key="history.day">–ó–∞ –¥–µ–Ω—å</option>
                        <option value="7" data-key="history.week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                        <option value="30" data-key="history.month">–ó–∞ –º–µ—Å—è—Ü</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="historyChart"></canvas>
                </div>
            </div>
            
            <!-- SETTINGS -->
            <div id="settings" class="tab-content">
                <h2 data-key="settings.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π... -->
                 <div class="settings-card">
                    <h3 data-key="settings.password">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h3>
                    <form id="changePasswordForm">
                        <div class="input-group">
                            <label for="currentPassword" data-key="settings.currentPassword">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="input-group">
                            <label for="newPassword" data-key="settings.newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="newPassword" required>
                        </div>
                        <div class="input-group">
                            <label for="confirmPassword" data-key="settings.confirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                            <input type="password" id="confirmPassword" required>
                        </div>
                        <button type="submit" class="form-btn" data-key="settings.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </form>
                </div>

                <div class="settings-card">
                    <h3 data-key="settings.notifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <button id="enableFCM" class="form-btn" data-key="settings.enablePush">–†–∞–∑—Ä–µ—à–∏—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                    
                    <div class="toggle-row">
                        <label class="switch">
                            <input type="checkbox" id="coNotifications" checked>
                            <span class="slider"></span>
                        </label>
                        <p data-key="settings.coNotifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ CO</p>
                    </div>
                    <div class="toggle-row">
                        <label class="switch">
                            <input type="checkbox" id="motionNotifications" checked>
                            <span class="slider"></span>
                        </label>
                        <p data-key="settings.motionNotifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–≤–∏–∂–µ–Ω–∏–∏</p>
                    </div>
                    <div class="toggle-row">
                        <label class="switch">
                            <input type="checkbox" id="energyNotifications" checked>
                            <span class="slider"></span>
                        </label>
                        <p data-key="settings.energyNotifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–∏—Ç–∞–Ω–∏–∏</p>
                    </div>
                </div>
                
                <div class="settings-card">
                    <h3 data-key="settings.status">–°—Ç–∞—Ç—É—Å Raspberry Pi</h3>
                    <div class="status-display">
                        <span id="statusIcon">‚óè</span> 
                        <span id="statusText" data-key="settings.checking">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                </div>


                <div class="settings-card">
                    <h3 data-key="wifi.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –°–µ—Ç–∏ Raspberry</h3>
                    <form id="networkForm">
                        <h4>WiFi –ö–ª–∏–µ–Ω—Ç (–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–æ—É—Ç–µ—Ä—É)</h4>
                        <div class="input-group">
                            <label>WiFi SSID</label>
                            <input type="text" id="wifiSSID" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–∏">
                        </div>
                        <div class="input-group">
                            <label>WiFi Password</label>
                            <input type="text" id="wifiPass" placeholder="–ü–∞—Ä–æ–ª—å">
                        </div>

                        <!-- <h4 style="margin-top: 15px;">–¢–æ—á–∫–∞ –î–æ—Å—Ç—É–ø–∞ (–†–∞–∑–¥–∞—á–∞)</h4>
                        <div class="input-group">
                            <label>AP SSID</label>
                            <input type="text" id="apSSID" placeholder="–ò–º—è —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞">
                        </div>
                        <div class="input-group">
                            <label>AP Password</label>
                            <input type="text" id="apPass" placeholder="–ü–∞—Ä–æ–ª—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞">
                        </div> -->

                        <button type="submit" class="form-btn" data-key="settings.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏</button>
                    </form>
                </div>
                
                <div class="settings-card">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IP –ö–∞–º–µ—Ä–∞–º–∏ (RTSP)</h3>
                    
                    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
                    <form id="ipCamForm">
                         <div class="input-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã</label>
                            <input type="text" id="camName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É—Ö–Ω—è" required>
                        </div>
                        <div class="input-group">
                            <label>RTSP –°—Å—ã–ª–∫–∞ (–ü–æ–ª–Ω–∞—è)</label>
                            <input type="text" id="camLink" placeholder="rtsp://admin:pass@192.168.1.X:554/..." required>
                            <small style="color: #666; font-size: 0.8em;">–î–ª—è –æ–±—ã—á–Ω—ã—Ö –∫–∞–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç: rtsp://–ª–æ–≥–∏–Ω:–ø–∞—Ä–æ–ª—å@IP:554/–ø–æ—Ç–æ–∫</small>
                        </div>
                        <button type="submit" class="form-btn">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
                    </form>

                    <!-- –°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–º–µ—Ä -->
                    
                     
                </div>
                
                 <div class="settings-card">
                     <a id="telegramButton" href="#" target="_blank" rel="noopener noreferrer" 
                        class="form-btn" style="display: block; text-align: center; text-decoration: none; box-sizing: border-box; width: 100%;">–ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram-–±–æ—Ç–∞</a>
                    <!-- <button class="form-btn" onclick="window.location.href='device.html'">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤</button> -->
                </div>
            </div>
        </div>
    </main>

    <!-- overlay -->
      <div id="deviceOverlay" class="overlay">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 id="overlayTitle">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h2>
                <button class="close-overlay" onclick="closeDeviceOverlay()">&times;</button>
            </div>
            
            <div id="overlayPlayerContainer" class="video-player-box" style="display: none;">
                <video id="overlayVideo" controls playsinline muted></video>
                <button class="close-video-btn" onclick="closeOverlayVideo()">–ó–∞–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ</button>
            </div>

            <div id="overlayDetails" class="device-details-grid">
            </div>

            <div id="overlayControlsPanel" class="device-controls-section" style="padding: 20px; border-bottom: 1px solid var(--divider);">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="sendDeviceAction('record')">üî¥ –ó–∞–ø–∏—Å—å</button>
                    <input type="number" id="recordSeconds" value="10" min="1" max="60" style="width: 70px; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
                    <span>—Å–µ–∫.</span>
                    <button class="btn" onclick="sendDeviceAction('stop_record')">‚¨õ –°—Ç–æ–ø</button>
                    <button id="overlayFlashBtn" class="btn" style="background: #FFC107; color: black; display: none;" onclick="sendDeviceAction('flashlight')">üî¶ –§–æ–Ω–∞—Ä—å</button>
                </div>
            </div>

            <div class="video-list-section">
                <h3>–ó–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ</h3>
                <div id="overlayVideosList" class="overlay-list">
                </div>
            </div>
        </div>
    </div>

    

    <script src="language-manager.js"></script>
    <script src="index.js"></script>
</body>
</html>
